#!/bin/bash

# Script for converting markdown files to HTML
# with github flavored format and stylesheet
#
#   - If no file is provided, then it checks for a README.md
#     in the current directory and converts it

md_file="$1"
default_dir="./.markdown"
stylesheet="$HOME/.local/bin/markdown/github-markdown-dark.css"

main() {
    if [ -z "${md_file}" ]; then
        if [ -f "./README.md" ]; then
            md_file="README.md"
        else
            echo "mark: No file provided and no README detected"
            return
        fi
    elif [ -d "$md_file" ]; then
        echo "mark: $md_file is a directory"
    fi

    [ -d "$default_dir" ] || mkdir "$default_dir"

    if [ ! -f "$default_dir/style.css" ]; then
        ln -s "$stylesheet" "$default_dir/style.css"
    fi
    
    tmpfile=$(mktemp)
    md2html --github --output="$tmpfile" "$md_file"

    output_html="${default_dir}/${md_file}.html"

    cat "$HOME/.local/bin/markdown/start-mark.html" \
        "$tmpfile" \
        "$HOME/.local/bin/markdown/end-mark.html" > "${output_html}"

    echo "Created: $(realpath $output_html)"
    rm "$tmpfile"
}

main

